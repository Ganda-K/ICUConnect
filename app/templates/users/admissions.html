{% extends "users/base.html" %} {% block content %}
<div class="container-fluid px-4 admissions-page">
	<!-- Header with Minimal Design -->
	<div class="d-flex justify-content-between align-items-center mb-4 mt-3">
		<h2 class="fw-bold">Patient Admissions</h2>
		<button class="btn btn-primary" id="newAdmissionBtn">
			<i class="fas fa-plus me-2"></i> New Admission
		</button>
	</div>

	<!-- Summary Cards - Horizontal Layout -->
	<div class="row g-4">
		<!-- Admissions Card -->
		<div class="col-md-4">
			<div class="summary-card border-primary">
				<div class="icon-wrapper bg-primary-light text-primary">
					<i class="fas fa-clock"></i>
				</div>
				<div>
					<p class="title">Today's Admissions</p>
					<h2 class="value">{{ today_admissions_count }}</h2>
					<p
						class="change {% if admissions_change >= 0 %}positive{% else %}negative{% endif %}">
						<i
							class="fas {% if admissions_change >= 0 %}fa-arrow-up{% else %}fa-arrow-down{% endif %}"></i>
						{{ admissions_change|abs }}% from yesterday
					</p>
				</div>
			</div>
		</div>

		<!-- ICU Patients Card -->
		<div class="col-md-4">
			<div class="summary-card border-danger">
				<div class="icon-wrapper bg-danger-light text-danger">
					<i class="fas fa-bolt"></i>
				</div>
				<div>
					<p class="title">Current ICU Patients</p>
					<h2 class="value">{{ current_patients_count }}</h2>
					<p
						class="change {% if patients_change >= 0 %}positive{% else %}negative{% endif %}">
						<i
							class="fas {% if patients_change >= 0 %}fa-arrow-up{% else %}fa-arrow-down{% endif %}"></i>
						{{ patients_change|abs }}% from yesterday
					</p>
				</div>
			</div>
		</div>

		<!-- Avg. Stay Card -->
		<div class="col-md-4">
			<div class="summary-card border-purple">
				<div class="icon-wrapper bg-purple-light text-purple">
					<i class="fas fa-calendar-alt"></i>
				</div>
				<div>
					<p class="title">Avg. Length of Stay</p>
					<h2 class="value">{{ avg_length_of_stay }} days</h2>
					<p
						class="change {% if stay_improvement >= 0 %}positive{% else %}negative{% endif %}">
						<i
							class="fas {% if stay_improvement >= 0 %}fa-arrow-up{% else %}fa-arrow-down{% endif %}"></i>
						{{ stay_improvement|abs }} days {% if stay_improvement >= 0
						%}improvement{% else %}increase{% endif %}
					</p>
				</div>
			</div>
		</div>
	</div>

	<!-- Recent Admissions Table -->
	<div class="card mt-5">
		<div class="card-body">
			<h5 class="card-title mb-4">Recent Admissions</h5>
			<div class="table-responsive">
				<table class="table table-hover admissions-table">
					<thead>
						<tr>
							<th>PATIENT</th>
							<th>AGE/GENDER</th>
							<th>BED</th>
							<th>DOCTOR</th>
							<th>REASON</th>
							<th>ADMITTED</th>
							<th>STATUS</th>
						</tr>
					</thead>
					<tbody>
						{% for admission in recent_admissions %}
						<tr>
							<td>{{ admission.masked_patient_name }}</td>
							<td>{{ admission.age }} / {{ admission.gender[0] }}</td>
							<td>{{ admission.bed.bed_number }}</td>
							<!-- Changed to use relationship -->
							<td>Dr. {{ admission.doctor }}</td>
							<td>{{ admission.reason }}</td>
							<td>{{ admission.admission_time.strftime('%Y-%m-%d %H:%M') }}</td>
							<td>
								<span
									class="badge bg-{% if admission.status == 'Active' %}success{% else %}secondary{% endif %}">
									{{ admission.status }}
								</span>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="mt-3 text-muted">
				Showing {{ recent_admissions|length }} of {{ current_patients_count }}
				patients
			</div>
			<nav aria-label="Admissions pagination" class="mt-3">
				<ul class="pagination justify-content-center">
					<li class="page-item {% if page <= 1 %}disabled{% endif %}">
						<a
							class="page-link"
							href="{{ url_for('admission.admissions', page=page-1) }}"
							tabindex="-1"
							>Previous</a
						>
					</li>
					<li class="page-item disabled">
						<a class="page-link" href="#"
							>Page {{ page }} of {{ total_pages }}</a
						>
					</li>
					<li class="page-item {% if page >= total_pages %}disabled{% endif %}">
						<a
							class="page-link"
							href="{{ url_for('admission.admissions', page=page+1) }}"
							>Next</a
						>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>

{% include 'users/partials/admission_form.html' %} {% endblock %} {% block
scripts %}
<script src="{{ url_for('static', filename='js/admissions.js') }}"></script>
{% endblock %}
